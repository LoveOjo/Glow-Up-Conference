<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glow Up â€“ I Will Be Attending</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&display=swap');

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    min-height: 100vh;
    background: linear-gradient(135deg, #e8f4fd 0%, #d0e8f5 40%, #b8d9ee 100%);
    font-family: 'Inter', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 30px 16px;
  }

  .card {
    background: white;
    border-radius: 24px;
    box-shadow: 0 20px 60px rgba(0,80,160,0.15);
    padding: 40px 36px;
    max-width: 480px;
    width: 100%;
    text-align: center;
  }

  .church-tag {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: #1a6fb5;
    margin-bottom: 6px;
  }

  h1 {
    font-family: 'Playfair Display', serif;
    font-size: 26px;
    color: #0d3a6b;
    margin-bottom: 4px;
  }

  .subtitle {
    font-size: 13px;
    color: #5a8ab5;
    margin-bottom: 28px;
  }

  /* Drop zone */
  .drop-zone {
    border: 2.5px dashed #7ab8e0;
    border-radius: 16px;
    padding: 36px 20px;
    cursor: pointer;
    transition: all 0.25s;
    background: #f4faff;
    position: relative;
    margin-bottom: 24px;
  }
  .drop-zone:hover, .drop-zone.dragover {
    border-color: #1a6fb5;
    background: #e6f3fb;
  }
  .drop-zone input[type=file] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }
  .drop-icon {
    font-size: 42px;
    margin-bottom: 10px;
  }
  .drop-text {
    font-size: 15px;
    font-weight: 600;
    color: #0d3a6b;
    margin-bottom: 4px;
  }
  .drop-sub {
    font-size: 12px;
    color: #7ab8e0;
  }

  /* Preview of uploaded photo */
  #preview-wrap {
    display: none;
    margin-bottom: 24px;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }
  #preview-wrap.visible { display: flex; }
  #photo-preview {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #1a6fb5;
    box-shadow: 0 4px 20px rgba(26,111,181,0.3);
  }
  .change-btn {
    font-size: 12px;
    color: #1a6fb5;
    cursor: pointer;
    text-decoration: underline;
    background: none;
    border: none;
  }

  /* Download button */
  #download-btn {
    display: none;
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #1a6fb5, #0d3a6b);
    color: white;
    font-size: 16px;
    font-weight: 700;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: transform 0.15s, box-shadow 0.15s;
    box-shadow: 0 6px 20px rgba(13,58,107,0.35);
  }
  #download-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 28px rgba(13,58,107,0.4);
  }
  #download-btn.visible { display: block; }

  .hint {
    font-size: 11px;
    color: #9bbcd6;
    margin-top: 16px;
  }

  /* Hidden canvas */
  #canvas { display: none; }

  .spinner {
    display: none;
    width: 22px; height: 22px;
    border: 3px solid rgba(255,255,255,0.4);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    margin: 0 auto;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div class="card">
  <div class="church-tag">Love Fellowship Â· Clemson SC</div>
  <h1>Glow Up 2026 âœ¨</h1>
  <p class="subtitle">Upload your photo and download your personalised flyer</p>

  <div class="drop-zone" id="drop-zone">
    <input type="file" id="file-input" accept="image/*">
    <div class="drop-icon">ðŸ“·</div>
    <div class="drop-text">Click or drag your photo here</div>
    <div class="drop-sub">JPG, PNG or HEIC Â· Best results with a clear headshot</div>
  </div>

  <div id="preview-wrap">
    <img id="photo-preview" src="" alt="Your photo preview">
    <button class="change-btn" onclick="resetPhoto()">Change photo</button>
  </div>

  <button id="download-btn" onclick="generateFlyer()">
    <span id="btn-text">â¬‡ Download My Flyer</span>
    <div class="spinner" id="spinner"></div>
  </button>

  <p class="hint">Your photo never leaves your device â€” everything happens in your browser.</p>
</div>

<canvas id="canvas"></canvas>

<script>
  const fileInput = document.getElementById('file-input');
  const dropZone = document.getElementById('drop-zone');
  const previewWrap = document.getElementById('preview-wrap');
  const photoPreview = document.getElementById('photo-preview');
  const downloadBtn = document.getElementById('download-btn');

  let userImage = null;

  // Drag & drop
  dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) loadFile(file);
  });

  fileInput.addEventListener('change', () => {
    if (fileInput.files[0]) loadFile(fileInput.files[0]);
  });

  function loadFile(file) {
    const reader = new FileReader();
    reader.onload = e => {
      const img = new Image();
      img.onload = () => {
        userImage = img;
        photoPreview.src = e.target.result;
        dropZone.style.display = 'none';
        previewWrap.classList.add('visible');
        downloadBtn.classList.add('visible');
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }

  function resetPhoto() {
    userImage = null;
    fileInput.value = '';
    dropZone.style.display = '';
    previewWrap.classList.remove('visible');
    downloadBtn.classList.remove('visible');
  }

  function generateFlyer() {
    if (!userImage) return;

    const btnText = document.getElementById('btn-text');
    const spinner = document.getElementById('spinner');
    btnText.style.display = 'none';
    spinner.style.display = 'block';

    const flyerImg = new Image();
    flyerImg.crossOrigin = 'anonymous';
    flyerImg.onload = () => {
      const canvas = document.getElementById('canvas');
      // Use the flyer's natural size
      canvas.width = flyerImg.naturalWidth;
      canvas.height = flyerImg.naturalHeight;
      const ctx = canvas.getContext('2d');

      // Draw flyer background
      ctx.drawImage(flyerImg, 0, 0);

      // â”€â”€ Circle position (calibrated to the black circle on the flyer) â”€â”€
      // Flyer is roughly 960Ã—1245px at natural resolution.
      // Circle centre â‰ˆ x:480, y:430  radius â‰ˆ 195
      const W = canvas.width;
      const H = canvas.height;

      const cx = W * 0.500;   // horizontal centre
      const cy = H * 0.345;   // vertical centre of circle
      const r  = W * 0.202;   // circle radius

      // Clip to circle
      ctx.save();
      ctx.beginPath();
      ctx.arc(cx, cy, r, 0, Math.PI * 2);
      ctx.closePath();
      ctx.clip();

      // Draw user photo centred and cover-fitted inside circle
      const diameter = r * 2;
      const scale = Math.max(diameter / userImage.width, diameter / userImage.height);
      const sw = userImage.width * scale;
      const sh = userImage.height * scale;
      ctx.drawImage(userImage, cx - sw / 2, cy - sh / 2, sw, sh);

      ctx.restore();

      // Trigger download
      canvas.toBlob(blob => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'GlowUp2026-MyFlyer.jpg';
        a.click();
        URL.revokeObjectURL(url);

        btnText.style.display = '';
        spinner.style.display = 'none';
      }, 'image/jpeg', 0.95);
    };

    // Load the flyer template from the same folder
    flyerImg.src = 'flyer-template.jpg';
  }
</script>
</body>
</html>
